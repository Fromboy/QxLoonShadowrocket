# 功能：在 QX 中攔截 HLS 廣告流（.m3u8）
# 用法：導入 snippet 模組，可嵌入到主配置中
# 注意：需搭配 Rewrite 和 Script 模組啟用
# 腳本支援：cmsAdblock.js
# 1.	📦 Stash 去广告规则（.stoverride）Stash=Modules → Override將 .stoverride 作為模組載入
# https://raw.githubusercontent.com/Fromboy/QxLoonShadowrocket/refs/heads/Stash/cms_adblock.stoverride
# 2.	🌕 Loon 去广告插件（.plugin）Loon插件中心使用 .plugin 插件導入
# https://raw.githubusercontent.com/Fromboy/QxLoonShadowrocket/refs/heads/Loon/cmsAdblock.plugin
# 3.	🌌 Quantumult X 去广告片段（.snippet）Quantumult X配置文件中 snippet在 [rewrite_local] 引入片段或直接粘貼內容到复写
# https://raw.githubusercontent.com/Fromboy/QxLoonShadowrocket/refs/heads/quantumult-x/cms_adblock.js
name: 去廣告｜CMS
desc: 去除插入式廣告 - 多來源支持
# icon: https://raw.githubusercontent.com/sooyaaabo/Loon/main/Icon/XPTV.png
# author: Yswag + Fromboy
# Stash 去广告配置
# 名称: 去廣告｜CMS
# 描述: 去除插入式廣告
# 图标: https://raw.githubusercontent.com/sooyaaabo/Loon/main/Icon/XPTV.png
# 致谢: https://github.com/Yswag
# 注意: Stash 不支持弹窗通知选择（原 Loon 的 #!select=彈窗通知,true,false），如需通知需在脚本中实现

# Stash 复写配置（.stoverride）
# 名称: 去廣告｜CMS
# 描述: 去除插入式廣告
# 图标: https://raw.githubusercontent.com/sooyaaabo/Loon/main/Icon/XPTV.png
# 致谢: https://github.com/Yswag
# 注意: Stash 不支持 Loon 的 #!select=彈窗通知,true,false，如需通知需在脚本中实现

rules:
  # 暴风跑马灯：重写 URL，移除 _z5q.ts 并进行 302 重定向
  - REDIRECT,^https?:\/\/s\d+\.bfengbf\.com\/video(.+)_z5q\.ts,$1$2.ts,302

http:
  mitm:
    # 需要拦截的域名列表，用于 MITM 处理
    - m3u8.heimuertv.com
    - m3u8.hmrvideo.com
    - v.cdnlz*.com
    - v.lzcdn*.com
    - vip*.lz-cdn*.com
    - vip.lzcdn*.com
    - "*.ffzy*.com"
    - "*.rrcdnbf*.com"
    - vip.kuaikan*.com
    - bfikuncdn.com
    - play.modujx*.com
    - vod.lyhuicheng.com
    - ukzy.ukubf*.com
    - "*.wgslsw.com"
    - askzycdn.com
    - t0.97img.com
    - "*.bfbfhao.com"
    - player.cl9987.com:188
    - v.ykv3.com
    - "*.3sybf.com"
    - bfnxxcdn.com
    - player.huangguam3u.com
    - leshiyuncdn.36s.top
    - cs1.feidaozy.com

  script:
    # 去广告脚本规则，应用 cmsAdblock.js 处理 m3u8 响应
    - name: CMS.Adblock.heimuertv
      type: http-response
      match: ^https?:\/\/m3u8\.(hmrvideo|heimuertv)\.com\/play\/(.+)\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.lzcdn
      type: http-response
      match: ^https?:\/\/((?:v\.lzcdn|v\.cdnlz|vip.*\.lz[-]?cdn)\d+\.com)\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.ffzy
      type: http-response
      match: ^https?:\/\/(super|svipsvip|vip)\.ffzy[A-Za-z0-9-]+\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.rrcdnbf
      type: http-response
      match: ^https?:\/\/c\d+\.rrcdnbf\d+\.com\/video\/(.+)\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.kuaikan
      type: http-response
      match: ^https?:\/\/vip\.kuaikan-(cdn|play)\d+\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.ikun
      type: http-response
      match: ^https:\/\/bfikuncdn\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.modujx
      type: http-response
      match: ^https:\/\/play\.modujx\d+\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.lyhuicheng
      type: http-response
      match: ^https:\/\/vod\.lyhuicheng\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.ukubf
      type: http-response
      match: ^https:\/\/ukzy\.ukubf\d+\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.wgslsw
      type: http-response
      match: ^https:\/\/.+\.wgslsw\.com\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.leshiyuncdn
      type: http-response
      match: ^https:\/\/leshiyuncdn\.36s\.top\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.feidaozy
      type: http-response
      match: ^https:\/\/.+\.feidaozy\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.askzycdn
      type: http-response
      match: ^https:\/\/askzycdn\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.97img
      type: http-response
      match: ^https:\/\/.+\.97img\.com\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.bfbfhao
      type: http-response
      match: ^https:\/\/.+\.bfbfhao\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.cl9987
      type: http-response
      match: ^https:\/\/player\.cl9987\.com:188\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.ykv3
      type: http-response
      match: ^https:\/\/v\.ykv3\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.3sybf
      type: http-response
      match: ^https:\/\/.+\.3sybf\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.bfnxxcdn
      type: http-response
      match: ^https:\/\/bfnxxcdn\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

    - name: CMS.Adblock.huangguam3u
      type: http-response
      match: ^https:\/\/player\.huangguam3u\.com\/.+\/hls\/.+\.m3u8
      script-provider: CMS.Adblock
      requires-body: true
      timeout: 30

script-providers:
  CMS.Adblock:
    url: https://raw.githubusercontent.com/Fromboy/JavaScript/refs/heads/Scripts/cmsAdblock.js
    interval: 86400
